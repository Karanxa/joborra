2025-08-24 16:37:27,187 INFO Using DATABASE_URL: postgresql://postgres.noupavjvuhezvzpqcbqg:***@aws-1-ap-southeast-2.pooler.supabase.com:6543/postgres?sslmode=require
2025-08-24 16:37:27,187 INFO Checking for SQLite source ./joborra.db ...
2025-08-24 16:37:27,187 INFO Connecting to SQLite source ...
2025-08-24 16:37:27,195 INFO Importing destination engine and models ...
2025-08-24 16:37:27,280 INFO Connecting to Supabase destination ...
2025-08-24 16:37:31,347 INFO Supabase connectivity check passed (SELECT 1).
2025-08-24 16:37:31,347 INFO Starting table copies ...
2025-08-24 16:37:31,350 ERROR Migration failed: When initializing mapper Mapper[User(users)], expression 'VisaVerification' failed to locate a name ('VisaVerification'). If this is a class name, consider adding this relationship() to the <class 'app.auth_models.User'> class after both dependent classes have been defined.
Traceback (most recent call last):
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 515, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 346, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 483, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'VisaVerification'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/karan/new/joborra/scripts/migrate_sqlite_to_supabase.py", line 155, in main
    copy_table(src_sess, dst_sess, app_models.Company)
  File "/home/karan/new/joborra/scripts/migrate_sqlite_to_supabase.py", line 53, in copy_table
    total = src_sess.query(Model).count()
            ^^^^^^^^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2912, in query
    return self._query_cls(entities, self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 276, in __init__
    self._set_entities(entities)
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 289, in _set_entities
    coercions.expect(
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 406, in expect
    insp._post_inspect
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1260, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2707, in _post_inspect
    self._check_configure()
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2386, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4199, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4240, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2403, in _post_configure_properties
    prop.init()
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 579, in init
    self.do_init()
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1635, in do_init
    self._setup_entity()
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1852, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 519, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 500, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[User(users)], expression 'VisaVerification' failed to locate a name ('VisaVerification'). If this is a class name, consider adding this relationship() to the <class 'app.auth_models.User'> class after both dependent classes have been defined.
2025-08-24 16:38:06,867 INFO Using DATABASE_URL: postgresql://postgres.noupavjvuhezvzpqcbqg:***@aws-1-ap-southeast-2.pooler.supabase.com:6543/postgres?sslmode=require
2025-08-24 16:38:06,867 INFO Checking for SQLite source ./joborra.db ...
2025-08-24 16:38:06,867 INFO Connecting to SQLite source ...
2025-08-24 16:38:06,873 INFO Importing destination engine and models ...
2025-08-24 16:38:06,973 INFO Connecting to Supabase destination ...
2025-08-24 16:38:12,091 INFO Supabase connectivity check passed (SELECT 1).
2025-08-24 16:38:12,092 INFO Starting table copies ...
2025-08-24 16:38:12,119 INFO Migrating companies: 103 rows
2025-08-24 16:38:58,920 INFO   -> 103/103
2025-08-24 16:38:58,924 INFO Migrating users: 10 rows
2025-08-24 16:39:04,018 INFO   -> 10/10
2025-08-24 16:39:04,022 INFO Migrating jobs: 906 rows
2025-08-24 16:41:03,598 ERROR Migration failed: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.StringDataRightTruncation) value too long for type character varying(100)

[SQL: INSERT INTO jobs (id, title, description, company_id, location, state, city, salary_min, salary_max, salary_currency, salary, employment_type, job_type, experience_level, remote_option, visa_sponsorship, visa_sponsorship_confidence, international_student_friendly, visa_type, source_website, source_url, source_job_id, required_skills, preferred_skills, education_requirements, posted_date, expires_at, job_document_url, posted_by_user_id, is_joborra_job, scraped_at, updated_at, is_active, is_duplicate) VALUES (%(id)s, %(title)s, %(description)s, %(company_id)s, %(location)s, %(state)s, %(city)s, %(salary_min)s, %(salary_max)s, %(salary_currency)s, %(salary)s, %(employment_type)s, %(job_type)s, %(experience_level)s, %(remote_option)s, %(visa_sponsorship)s, %(visa_sponsorship_confidence)s, %(international_student_friendly)s, %(visa_type)s, %(source_website)s, %(source_url)s, %(source_job_id)s, %(required_skills)s, %(preferred_skills)s, %(education_requirements)s, %(posted_date)s, %(expires_at)s, %(job_document_url)s, %(posted_by_user_id)s, %(is_joborra_job)s, %(scraped_at)s, %(updated_at)s, %(is_active)s, %(is_duplicate)s)]
[parameters: {'id': 267, 'title': 'Consumer Lifecycle Marketing Manager', 'description': '', 'company_id': 100, 'location': 'San Francisco, CA, USA; New York, NY, USA; Seattle, WA, USA; Chicago, IL, USA; Atlanta, GA, USA; Toronto, ON, Canada; Remote (Various Locations)', 'state': 'Western Australia', 'city': 'San Francisco, CA, USA; New York, NY, USA; Seattle, , USA; Chicago, IL, USA; Atlanta, GA, USA; Toronto, ON, Canada; Remote (Various Locations)', 'salary_min': None, 'salary_max': None, 'salary_currency': 'AUD', 'salary': None, 'employment_type': 'full-time', 'job_type': None, 'experience_level': None, 'remote_option': False, 'visa_sponsorship': False, 'visa_sponsorship_confidence': 0.0, 'international_student_friendly': False, 'visa_type': None, 'source_website': 'greenhouse.io', 'source_url': 'https://stripe.com/jobs/search?gh_jid=6960632', 'source_job_id': '6960632', 'required_skills': 'null', 'preferred_skills': 'null', 'education_requirements': None, 'posted_date': datetime.datetime(2025, 8, 14, 9, 13, 44), 'expires_at': None, 'job_document_url': None, 'posted_by_user_id': None, 'is_joborra_job': False, 'scraped_at': datetime.datetime(2025, 8, 20, 3, 54, 29), 'updated_at': None, 'is_active': True, 'is_duplicate': False}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
Traceback (most recent call last):
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(100)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/karan/new/joborra/scripts/migrate_sqlite_to_supabase.py", line 159, in main
    copy_table(src_sess, dst_sess, app_models.Job)
  File "/home/karan/new/joborra/scripts/migrate_sqlite_to_supabase.py", line 68, in copy_table
    dst_sess.merge(obj)  # merge preserves PK and upserts by PK
    ^^^^^^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3913, in merge
    self._autoflush()
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3021, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3010, in _autoflush
    self.flush()
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1043, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/home/karan/new/joborra/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(psycopg2.errors.StringDataRightTruncation) value too long for type character varying(100)

[SQL: INSERT INTO jobs (id, title, description, company_id, location, state, city, salary_min, salary_max, salary_currency, salary, employment_type, job_type, experience_level, remote_option, visa_sponsorship, visa_sponsorship_confidence, international_student_friendly, visa_type, source_website, source_url, source_job_id, required_skills, preferred_skills, education_requirements, posted_date, expires_at, job_document_url, posted_by_user_id, is_joborra_job, scraped_at, updated_at, is_active, is_duplicate) VALUES (%(id)s, %(title)s, %(description)s, %(company_id)s, %(location)s, %(state)s, %(city)s, %(salary_min)s, %(salary_max)s, %(salary_currency)s, %(salary)s, %(employment_type)s, %(job_type)s, %(experience_level)s, %(remote_option)s, %(visa_sponsorship)s, %(visa_sponsorship_confidence)s, %(international_student_friendly)s, %(visa_type)s, %(source_website)s, %(source_url)s, %(source_job_id)s, %(required_skills)s, %(preferred_skills)s, %(education_requirements)s, %(posted_date)s, %(expires_at)s, %(job_document_url)s, %(posted_by_user_id)s, %(is_joborra_job)s, %(scraped_at)s, %(updated_at)s, %(is_active)s, %(is_duplicate)s)]
[parameters: {'id': 267, 'title': 'Consumer Lifecycle Marketing Manager', 'description': '', 'company_id': 100, 'location': 'San Francisco, CA, USA; New York, NY, USA; Seattle, WA, USA; Chicago, IL, USA; Atlanta, GA, USA; Toronto, ON, Canada; Remote (Various Locations)', 'state': 'Western Australia', 'city': 'San Francisco, CA, USA; New York, NY, USA; Seattle, , USA; Chicago, IL, USA; Atlanta, GA, USA; Toronto, ON, Canada; Remote (Various Locations)', 'salary_min': None, 'salary_max': None, 'salary_currency': 'AUD', 'salary': None, 'employment_type': 'full-time', 'job_type': None, 'experience_level': None, 'remote_option': False, 'visa_sponsorship': False, 'visa_sponsorship_confidence': 0.0, 'international_student_friendly': False, 'visa_type': None, 'source_website': 'greenhouse.io', 'source_url': 'https://stripe.com/jobs/search?gh_jid=6960632', 'source_job_id': '6960632', 'required_skills': 'null', 'preferred_skills': 'null', 'education_requirements': None, 'posted_date': datetime.datetime(2025, 8, 14, 9, 13, 44), 'expires_at': None, 'job_document_url': None, 'posted_by_user_id': None, 'is_joborra_job': False, 'scraped_at': datetime.datetime(2025, 8, 20, 3, 54, 29), 'updated_at': None, 'is_active': True, 'is_duplicate': False}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-08-24 16:41:58,437 INFO Using DATABASE_URL: postgresql://postgres.noupavjvuhezvzpqcbqg:***@aws-1-ap-southeast-2.pooler.supabase.com:6543/postgres?sslmode=require
2025-08-24 16:41:58,438 INFO Checking for SQLite source ./joborra.db ...
2025-08-24 16:41:58,438 INFO Connecting to SQLite source ...
2025-08-24 16:41:58,444 INFO Importing destination engine and models ...
2025-08-24 16:41:58,557 INFO Connecting to Supabase destination ...
2025-08-24 16:42:02,828 INFO Supabase connectivity check passed (SELECT 1).
2025-08-24 16:42:02,828 INFO Starting table copies ...
2025-08-24 16:42:02,855 INFO Migrating companies: 103 rows
2025-08-24 16:42:49,677 INFO   -> 103/103
2025-08-24 16:42:49,681 INFO Migrating users: 10 rows
2025-08-24 16:42:52,604 INFO   -> 10/10
2025-08-24 16:42:52,607 INFO Migrating jobs: 906 rows
2025-08-24 16:50:09,223 INFO Using DATABASE_URL: postgresql://postgres.noupavjvuhezvzpqcbqg:***@aws-1-ap-southeast-2.pooler.supabase.com:6543/postgres?sslmode=require
2025-08-24 16:50:09,223 INFO Checking for SQLite source ./joborra.db ...
2025-08-24 16:50:09,223 INFO Connecting to SQLite source ...
2025-08-24 16:50:09,228 INFO Importing destination engine and models ...
2025-08-24 16:50:09,314 INFO Connecting to Supabase destination ...
2025-08-24 16:50:13,401 INFO Supabase connectivity check passed (SELECT 1).
2025-08-24 16:50:13,401 INFO Starting table copies ...
2025-08-24 16:50:13,425 INFO Migrating companies: 103 rows
2025-08-24 16:51:00,319 INFO   -> 103/103
2025-08-24 16:51:00,323 INFO Migrating users: 10 rows
2025-08-24 16:51:03,209 INFO   -> 10/10
2025-08-24 16:51:03,213 INFO Migrating jobs: 906 rows
2025-08-24 16:57:49,381 INFO   -> 906/906
2025-08-24 16:57:49,385 INFO Migrating job_favorites: 0 rows
2025-08-24 16:57:49,387 INFO Migrating job_applications: 0 rows
2025-08-24 16:57:49,389 INFO Migrating job_views: 0 rows
2025-08-24 16:57:49,391 INFO Migrating visa_keywords: 37 rows
2025-08-24 16:58:06,506 INFO   -> 37/37
2025-08-24 16:58:06,508 INFO Migrating scraping_logs: 0 rows
2025-08-24 16:58:06,508 INFO Resetting sequences ...
2025-08-24 16:58:07,417 INFO Reset sequence for companies(id)
2025-08-24 16:58:08,306 INFO Reset sequence for users(id)
2025-08-24 16:58:09,213 INFO Reset sequence for jobs(id)
2025-08-24 16:58:09,878 WARNING Could not reset sequence for job_favorites: (psycopg2.errors.NumericValueOutOfRange) setval: value 0 is out of bounds for sequence "job_favorites_id_seq" (1..2147483647)

[SQL: SELECT setval(pg_get_serial_sequence(%(table)s, %(pk)s), COALESCE((SELECT MAX("id") FROM "job_favorites"), 0))]
[parameters: {'table': 'job_favorites', 'pk': 'id'}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-08-24 16:58:10,773 WARNING Could not reset sequence for job_applications: (psycopg2.errors.NumericValueOutOfRange) setval: value 0 is out of bounds for sequence "job_applications_id_seq" (1..2147483647)

[SQL: SELECT setval(pg_get_serial_sequence(%(table)s, %(pk)s), COALESCE((SELECT MAX("id") FROM "job_applications"), 0))]
[parameters: {'table': 'job_applications', 'pk': 'id'}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-08-24 16:58:11,676 WARNING Could not reset sequence for job_views: (psycopg2.errors.NumericValueOutOfRange) setval: value 0 is out of bounds for sequence "job_views_id_seq" (1..2147483647)

[SQL: SELECT setval(pg_get_serial_sequence(%(table)s, %(pk)s), COALESCE((SELECT MAX("id") FROM "job_views"), 0))]
[parameters: {'table': 'job_views', 'pk': 'id'}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-08-24 16:58:12,785 INFO Reset sequence for visa_keywords(id)
2025-08-24 16:58:13,456 WARNING Could not reset sequence for scraping_logs: (psycopg2.errors.NumericValueOutOfRange) setval: value 0 is out of bounds for sequence "scraping_logs_id_seq" (1..2147483647)

[SQL: SELECT setval(pg_get_serial_sequence(%(table)s, %(pk)s), COALESCE((SELECT MAX("id") FROM "scraping_logs"), 0))]
[parameters: {'table': 'scraping_logs', 'pk': 'id'}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-08-24 16:58:13,676 INFO 
Migration completed successfully.
